<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Voice Assistant</title>
  <style>
    #voice-widget {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 360px;
      height: 500px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      font-family: sans-serif;
      z-index: 99999;
    }
    #voice-widget iframe {
      border: none;
      width: 100%;
      height: 100%;
    }
  </style>

  <script>
    // compute base URL robustly:
    // 1) try to derive from the loader script (if the widget is loaded via a loader script)
    // 2) fallback to the current page origin (works when widgets.html is served directly)
    (function () {
      const scriptEl = document.currentScript || document.querySelector('script[src*="widget.js"], script[src*="loader.js"]');
      let BASE_URL = location.origin;
      try {
        if (scriptEl && scriptEl.src) {
          BASE_URL = new URL(scriptEl.src).origin;
        }
      } catch (e) {
        BASE_URL = location.origin;
      }
      // expose for debugging if needed (remove in production)
      console.log('Widget base URL:', BASE_URL);

      // set iframe src after DOM is ready to avoid literal template tokens and encoding issues
      function setIframeSrc() {
        const iframe = document.querySelector('#voice-widget iframe');
        if (!iframe) return;
        // ensure we don't accidentally include template strings
        iframe.src = BASE_URL + './index.html';
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setIframeSrc, { once: true });
      } else {
        setIframeSrc();
      }
    })();
  </script>
</head>

<body>
  <div id="voice-widget">
    <!-- avoid template placeholder here; JS will populate src -->
    <iframe src="about:blank" title="Voice assistant"></iframe>
  </div>
</body>
</html>
