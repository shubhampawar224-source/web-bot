<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <style>
    body { margin: 0; font-family: Arial; display: flex; flex-direction: column; height: 100%; }
    #chat-box { flex: 1; overflow-y: auto; padding: 10px; background: #f9f9f9; }
    #input-bar { display: flex; border-top: 1px solid #ccc; }
    input { flex: 1; padding: 10px; border: none; outline: none; }
    button { padding: 10px; border: none; background: #007bff; color: white; cursor: pointer; }
  </style>
</head>
<body>
  <div id="chat-box"></div>
  <div id="input-bar">
    <input id="userInput" placeholder="Speak or type..." />
    <button id="sendBtn">Send</button>
  </div>

  <script>
    const ws = new WebSocket(`wss://${location.host}/ws/voice`);
    const chatBox = document.getElementById('chat-box');
    const input = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');

    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      const div = document.createElement('div');
      div.textContent = "Bot: " + data.bot_text;
      chatBox.appendChild(div);
      if (data.audio) {
        const audio = new Audio("data:audio/wav;base64," + data.audio);
        audio.play();
      }
    };

    sendBtn.onclick = () => sendMessage();
    input.onkeypress = (e) => { if (e.key === "Enter") sendMessage(); };

    function sendMessage() {
      const text = input.value.trim();
      if (!text) return;
      chatBox.innerHTML += `<div>You: ${text}</div>`;
      input.value = "";
      // Convert to base64 silent message for uniformity
      ws.send(JSON.stringify({ audio: "", text }));
    }
  </script>
</body>
</html>
